steps:
  - name: openjdk:11
    id: test
    entrypoint: "/bin/bash"
    args:
      - '-c'
      - |-
        set -x
        ./gradlew -p sample-caller check
        ./gradlew -p sample-producer check

  - name: openjdk:11
    id: build-image
    entrypoint: "/bin/bash"
    args:
      - '-c'
      - |-
        set -x
        ./gradlew -p sample-caller bootBuildImage --imageName=us-docker.pkg.dev/$PROJECT_ID/docker-repo/sample-caller:$SHORT_SHA
        ./gradlew -p sample-producer bootBuildImage --imageName=us-docker.pkg.dev/$PROJECT_ID/docker-repo/sample-producer:$SHORT_SHA

images:
  - us-docker.pkg.dev/$PROJECT_ID/docker-repo/sample-caller:$SHORT_SHA
  - us-docker.pkg.dev/$PROJECT_ID/docker-repo/sample-producer:$SHORT_SHA